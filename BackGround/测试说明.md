# 倒计时应用测试说明

## 后台倒计时测试步骤

### 1. 基本功能测试
1. 启动应用
2. 设置一个短时间（如30秒）进行测试
3. 点击"开始倒计时"
4. 确认倒计时正常显示和更新

### 2. 后台运行测试
1. 开始倒计时后，按 Home 键或切换到其他应用
2. 等待几秒钟
3. 重新打开倒计时应用
4. 检查倒计时是否继续运行，时间是否正确

### 3. 通知功能测试
1. 设置一个短时间（如10秒）
2. 开始倒计时后切换到后台
3. 等待倒计时完成
4. 检查是否收到通知提醒

### 4. 状态恢复测试
1. 开始倒计时后切换到后台
2. 强制关闭应用（从多任务界面向上滑动）
3. 重新打开应用
4. 检查倒计时状态是否正确恢复

## 技术改进说明

### 后台运行优化
- **DispatchSourceTimer**: 使用更可靠的后台定时器
- **状态持久化**: 使用 UserDefaults 保存倒计时状态
- **生命周期管理**: 监听应用前后台切换事件

### 关键改进点
1. **双重定时器**: 同时使用 Timer 和 DispatchSourceTimer
2. **状态保存**: 进入后台时保存当前状态
3. **状态恢复**: 进入前台时恢复正确的时间
4. **通知调度**: 使用本地通知确保倒计时完成提醒

## 预期行为

### 正常情况
- 应用在前台：倒计时正常显示和更新
- 应用在后台：倒计时继续运行
- 重新打开应用：显示正确的剩余时间
- 倒计时完成：收到通知提醒

### 特殊情况
- 应用被强制关闭：重新打开时恢复状态
- 系统重启：倒计时状态丢失（这是正常的）
- 长时间后台：系统可能会限制后台运行时间

## 故障排除

### 如果后台倒计时不工作
1. 检查通知权限是否已授予
2. 确认应用的后台模式已正确配置
3. 在真机上测试（模拟器后台功能有限）

### 如果通知不显示
1. 检查系统通知设置
2. 确认应用的通知权限
3. 检查是否开启了勿扰模式

## 性能优化

- 使用 DispatchSourceTimer 减少 CPU 使用
- 状态持久化避免重复计算
- 及时清理定时器资源
- 优化后台任务生命周期 